<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Employee Details Fetcher</title>
    <link rel="stylesheet" href="./Frontend/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="./Frontend/js/bootstrap.bundle.min.js">
    <style>
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(90deg, #4facfe 0%, #00f2fe 100%);
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            background-color: #f8f9fa;
        }

        header {
        position: relative;
        color: white;
        }

        header::before {
            content: "";
            display: block;
            width: 100%;
            height: 5px;
            background-color: red;
            position: absolute;
            top: 0;
            left: 0;
        }

        header {
            background-color: red;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            padding: 15px 20px; /* Adjusted padding to account for the red line */
        }

        nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        nav .logo {
            font-size: 24px;
            font-weight: bold;
        }

        nav ul {
            list-style: none;
            display: flex;
            gap: 20px;
        }

        nav ul li {
            display: inline;
        }

        nav ul li a {
            text-decoration: none;
            color: #333;
            font-size: 16px;
            color: white;
        }

        .btn-get-started {
            background: linear-gradient(90deg, #ff8c00 0%, #ff00ff 100%);
            color: #fff;
            padding: 10px 40px;
            border-radius: 20px;
            text-decoration: none;
            font-size: 16px;
            transition: background-color 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            position: relative;
        }

        .btn-get-started img {
            width: 20px;
            height: 20px;
            position: absolute;
            top: 50%;
            left: 10px;
            transform: translateY(-50%);
        }

        .btn-get-started:hover {
            background-color: #e07b00;
        }
        
        .employee-card {
            margin-bottom: 20px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            transition: all .5s;
            width: 98%;
        }
        .employee-card:hover {
            background-color: rgba(0,0,0,.075);
            width: 100%;
            cursor: pointer !important;
        }
        .employee-card h5 {
            margin-bottom: 15px;
        }
        .navbar-brand h1 {
            font-weight: 400;
            font-family: san-serif;
            line-height: 2rem;
            font-size: 1.75rem;
            white-space: nowrap;
            margin-bottom: 1rem;
        }
        .profile-actions .btn{
            margin-right: 0.5em !important;
        }
        footer {
            background-color: #f8f9fa;
            padding: 20px;
            text-align: center;
            border-top: 1px solid #e9ecef;
            position: relative;
        }
        
        footer .container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }
        
        footer ul {
            list-style: none;
            padding: 0;
        }
        
        footer ul li {
            display: inline;
            margin: 0 10px;
        }
        
        footer ul li a {
            text-decoration: none;
            color: #6c757d;
        }
    </style>
</head>
<body>
    <header>
        <nav>
            <div class="logo">JobBridge (Employer)</div>
            <ul>
                <li><a href="employer_homepage.html">Home</a></li>
                <li><a href="postjob.html">Post a Job</a></li>
                <li><a href="employee_list.html">Candidate List</a></li>
                <li><a href="index.html">Register</a></li>
            </ul>
            <a href="employer_update_profile.html" class="btn-get-started text-end" id="myName"><img src="profilepic.jpg" alt="Small image" class="small-image" id="myImage">User</a>
        </nav>
    </header>

    <h1 class="my-4 fw-bold fs-1 fs-2-lg m-4 px-3 text-light">Candidate List</h1>

    <div class="row m-4">
        <!-- Candidate List -->
        <div class="container col-md-5 col-sm-4 ">
        
        <!-- Filter Form -->
        <div class="mb-4">
            <form id="filterForm" class="row g-3">
                <div class="col-md-4">
                    <select class="form-select" id="cityFilter">
                        <option value="all">All Cities</option>
                        <option value="Kuala Lumpur">Kuala Lumpur</option>
                        <option value="Penang">Penang</option>
                        <option value="Perak">Perak</option>
                        <option value="Kedah">Kedah</option>
                        <option value="Sarawak">Sarawak</option>
                        <option value="Johor">Johor</option>
                        <option value="Sabah">Sabah</option>
                        <option value="Perlis">Perlis</option>
                        <!-- Add more cities as needed -->
                    </select>
                </div>
                <div class="col-md-4">
                    <select class="form-select" id="salaryFilter">
                        <option value="all">All Salary Ranges</option>
                        <option value="2000">Below RM 2000</option>
                        <option value="4000">RM 2000 - RM 4000</option>
                        <option value="6000">RM 4000 - RM 6000</option>
                        <option value="8000">RM 6000 - RM 8000</option>
                        <option value="10000">Above RM 8000</option>
                    </select>
                </div>
                <div class="col-md-4">
                    <input type="text" class="form-control" id="jobFilter" placeholder="Keyword">
                </div>
                <div class="col-sm-12">
                    <button type="button" class="btn btn-primary" onclick="applyFilter()">Filter</button>
                    <button type="button" class="btn btn-secondary" onclick="resetFilter()">Reset</button>
                </div>
            </form>
        </div>
    
        <div class="row" id="employeeDetails"></div>
    </div>
    
    <!-- Candidate Details -->
    <div class="container  col-md-7 col-sm-8 px-3 ml-3">
        <h2 class='text-light'>Candidate details</h2>
        <hr>
        <!-- Candidate Profile -->
        <div class="container profile border-top shadow rounded p-4 mx-0 bg-light" id="candidateProfile">
            <!-- Profile header -->
            <div class="profile-header">
                <div class="d-flex align-items-center">
                    <img src="https://via.placeholder.com/60" alt="Profile Picture" id="profilePicture">
                    <div class="ms-3">
                        <h5 class="mb-0" id="candidateName">Alexander Christopher</h5>
                        <p class="mb-0 text-success" id="candidateStatus">Active</p>
                        <small id="applicationSource">Applied 5 days ago from LinkedIn</small>
                    </div>
                </div>
                <div class="profile-actions mt-3">
                    <button class="btn btn-success">Interview</button>
                    <button class="btn btn-danger" id="rejectButton">Reject</button>
                </div>
            </div>
    
            <!-- Profile Tabs -->
            <div class="profile-tabs mt-4">
                <ul class="nav nav-tabs">
                    <li class="nav-item">
                        <a class="nav-link active" id="overview-tab" data-bs-toggle="tab" href="#overview" role="tab">Overview</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" id="resume-tab" data-bs-toggle="tab" href="#resume" role="tab">Resume</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" id="additional-info-tab" data-bs-toggle="tab" href="#additional-info" role="tab">Additional Info</a>
                    </li>
                </ul>
            </div>
    
            <!-- Profile Content -->
            <div class="tab-content profile-content pt-3">
                <div class="tab-pane fade show active" id="overview" role="tabpanel" aria-labelledby="overview-tab">
                    <h3 class="my-3">Summary</h3>
                    <p><span id="candidateSummary">I love solving problems and finding new, creative ways to address challenges. Naturally empathetic and enjoy customer behaviour and finding new ways to reach your target market. Learning new technological trends and staying up to date. Certified UX designer who is passionate about creating aesthetic usable products by addressing the needs.</span></p>
                    <hr><h3 class="mb-3">Contact Details</h3>
                    <p><strong>Email Address:</strong> <span id="candidateEmail">batman@gmail.com</span></p>
                    <p><strong>Contact No:</strong> <span id="candidatePhone">+91 12345678</span></p>
                    <p><strong>Home Address:</strong> <span id="candidateAddress">+91 12345678</span></p>
                    <hr><h3 class="mb-3">Job Details</h3>
                    <p><strong>Highest Qualification:</strong> <span id="candidateQualification">B.TECH</span></p>
                    <p><strong>Current Company:</strong> <span id="candidateCompany">Accenture</span></p>
                    <p><strong>Total Experience:</strong> <span id="candidateExperience">5 Years</span></p>
                    <p><strong>Current Salary:</strong> <span id="candidateSalary">RM5000</span></p>
                    <p><strong>Expected Salary:</strong> <span id="candidateExpectedSalary">RM10000</span></p>
                </div>
                <div class="tab-pane fade" id="resume" role="tabpanel" aria-labelledby="resume-tab">
                    <p id="candidateResume">Resume content goes here...</p>
                </div>
                <div class="tab-pane fade" id="additional-info" role="tabpanel" aria-labelledby="additional-info-tab">
                    <p id="candidateAdditionalInfo">Additional information goes here...</p>
                </div>
            </div>
        </div>
    </div>
    </div>
    <footer class="footer mt-auto py-3 d-xxl-block d-none">
        <div class="container">
            <div class="d-flex justify-content-between align-items-center">
                <span class="text-muted">&copy; 2024 JobBridge</span>
                <ul class="list-inline mb-0">
                    <li class="list-inline-item"><a href="#" class="text-muted">User Agreement</a></li>
                    <li class="list-inline-item"><a href="#" class="text-muted">Privacy Policy</a></li>
                    <li class="list-inline-item"><a href="#" class="text-muted">Community Guidelines</a></li>
                    <li class="list-inline-item"><a href="#" class="text-muted">Cookie Policy</a></li>
                    <li class="list-inline-item"><a href="#" class="text-muted">Copyright Policy</a></li>
                    <li class="list-inline-item"><a href="#" class="text-muted">Send Feedback</a></li>
                    <li class="list-inline-item"><a href="#" class="text-muted">Language</a></li>
                </ul>
            </div>
        </div>
    </footer>

    <script>
        let employees = [];

        async function fetchEmployeeDetails() {
            try {
                const response = await fetch('./Backend/fetch_employee.php', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: ""
                });
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                employees = await response.json();
                renderEmployeeDetails(employees);
                if (employees.length > 0) {
                    showCandidateDetails(employees[0].full_name);
                }
            } catch (error) {
                console.error('There was a problem with the fetch operation:', error);
            }
        }

    function renderEmployeeDetails(employees) {
        const employeeDetailsDiv = document.getElementById('employeeDetails');
        if (employees.error) {
            employeeDetailsDiv.innerHTML = `<div class="alert alert-danger">${employees.error}</div>`;
        } else {
            let html = '';
            employees.reverse().forEach(employee => {
                html += `
                    <div class="row ">
                        <div class="employee-card bg-light p-4" onclick="showCandidateDetails('${employee.full_name}')">
                            <h5 class="card-title">${employee.full_name}</h5>
                            <p class="card-text"><strong>Expected Salary:</strong> RM${employee.expected_salary}</p>
                            <p class="card-text"><strong>Job Interested:</strong> ${employee.job_title}</p>
                            <p class="card-text"><strong>Preferred City:</strong> ${employee.job_city}</p>
                            <button class="btn btn-success mt-2" onclick="showCandidateDetails('${employee.full_name}')">More About Him</button>
                        </div>
                    </div>
                `;
            });
            employeeDetailsDiv.innerHTML = html;
            // <p class="card-text"><strong>Email:</strong> ${employee.email}</p>
            // <p class="card-text"><strong>Phone:</strong> +60${employee.phone}</p>
        }
    }

    function showCandidateDetails(fullName) {
        const candidate = employees.find(emp => emp.full_name === fullName);
        if (candidate) {
            document.getElementById('candidateName').textContent = candidate.full_name;
            document.getElementById('candidateStatus').textContent = candidate.job_title; // Update as per the actual status
            document.getElementById('applicationSource').textContent = "Applied 5 days ago from LinkedIn"; // Update as per actual data
            document.getElementById('candidateSummary').textContent = candidate.summary || "Summary not available.";
            document.getElementById('candidateEmail').textContent = candidate.email;
            document.getElementById('candidatePhone').textContent = `+60${candidate.phone}`;
            document.getElementById('candidateAddress').textContent = candidate.home_address;
            document.getElementById('candidateQualification').textContent = candidate.qualification || "Not specified";
            document.getElementById('candidateCompany').textContent = candidate.current_company || "Not specified";
            document.getElementById('candidateExperience').textContent = `${candidate.experience} Years` || "Not specified";
            document.getElementById('candidateSalary').textContent = `RM${candidate.current_salary}` || "Not specified";
            document.getElementById('candidateExpectedSalary').textContent = `RM${candidate.expected_salary}` || "Not specified";
            document.getElementById('candidateResume').textContent = candidate.resume || "Resume content not available.";
            document.getElementById('candidateAdditionalInfo').textContent = candidate.additional_info || "Additional information not available.";

            document.getElementById('rejectButton').onclick = () => rejectCandidate(candidate.full_name);
        }
    }

    function applyFilter() {
        const cityFilter = document.getElementById('cityFilter').value.toLowerCase();
        const salaryFilter = document.getElementById('salaryFilter').value;
        const jobFilter = document.getElementById('jobFilter').value.toLowerCase();

        const filteredEmployees = employees.filter(employee => {
            const matchesCity = cityFilter === 'all' || employee.job_city.toLowerCase() === cityFilter;
            const matchesSalary = salaryFilter === 'all' || (salaryFilter === "2000" && employee.expected_salary < 2000) ||
                (salaryFilter === "4000" && employee.expected_salary >= 2000 && employee.expected_salary < 4000) ||
                (salaryFilter === "6000" && employee.expected_salary >= 4000 && employee.expected_salary < 6000) ||
                (salaryFilter === "8000" && employee.expected_salary >= 6000 && employee.expected_salary < 8000) ||
                (salaryFilter === "10000" && employee.expected_salary >= 8000);
            const matchesJob = !jobFilter || employee.job_title.toLowerCase().includes(jobFilter);
            return matchesCity && matchesSalary && matchesJob;
        });

        renderEmployeeDetails(filteredEmployees);
    }

    function resetFilter() {
        document.getElementById('filterForm').reset();
        renderEmployeeDetails(employees);
    }

    function rejectCandidate(fullName) {
        employees = employees.filter(emp => emp.full_name !== fullName);
        renderEmployeeDetails(employees);
        if (employees.length > 0) {
            showCandidateDetails(employees[0].full_name);
        } else {
            clearCandidateDetails();
        }
    }

    function clearCandidateDetails() {
        document.getElementById('candidateName').textContent = '';
        document.getElementById('candidateStatus').textContent = '';
        document.getElementById('applicationSource').textContent = '';
        document.getElementById('candidateSummary').textContent = '';
        document.getElementById('candidateEmail').textContent = '';
        document.getElementById('candidatePhone').textContent = '';
        document.getElementById('candidateQualification').textContent = '';
        document.getElementById('candidateCompany').textContent = '';
        document.getElementById('candidateExperience').textContent = '';
        document.getElementById('candidateSalary').textContent = '';
        document.getElementById('candidateExpectedSalary').textContent = '';
        document.getElementById('candidateResume').textContent = '';
        document.getElementById('candidateAdditionalInfo').textContent = '';
    }

    document.addEventListener('DOMContentLoaded', fetchEmployeeDetails);
    </script>
</body>
</html>
